<!DOCTYPE html>
<html>
<head>
    <!--user2与user3的区别：将inplace编辑模式改成弹出6编辑窗口式-->
    <meta charset="utf-8">
    <title>啄木鸟风电维保系统</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="css/bootstrap.css"/>
    <script type="text/javascript" src="js/doTe.js"></script>
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.js"></script>
    <script src="laydate/laydate.js"></script>

    <script src="js/utils.js"></script>
    <link rel="stylesheet" href="css/cube.css" />
    <script src="js/Cube.js"></script>
    <script src="js/db.js"></script>
    <link rel="stylesheet" href="css/xpecker.css" />
    <script src="js/xpecker.js"></script>

    <style>
        .narrow>div>div:first-of-type {width: 140px;}
        .narrow>div>label:first-of-type {width: 40px;}
        .narrow>div,.narrow>div>div:first-of-type {margin-right: 0px;}

        /*为了解决BootStrap中css和layDate的css样式冲突*/
        .laydate_box, .laydate_box * {box-sizing: content-box;}
        .laydate_box th {text-align: center;}
    </style>
</head>
<body>
    <header>总步骤</header>
    <div id="main" style="width:1000px;height:400px;"></div>
    <footer><button onclick="save()">保存</button> <button onclick="skip()">下一步</button></footer>
    <script type="text/javascript">
        init();
        function init() {
            Reqdata("/rd?ls=config&type=ethnic", "", function (res) { g_ethnic = res.data; });
            Reqdata("/curuserinf", "", function (res) {
                g_user = res.data;
                $("#main").html(xruserform(g_user,res.fields));
            });
        }

        function hidechgpwd(This) {
            $(This).parent().parent().css("display", "none");
        }
        function xruserform(user, fields) {
            var ui =
                `<div class="x2Form narrow" >
                    <div style="margin-top:0px;"><label>帐号</label><div style="display:inline-block;">{account}</div></div>
                    <div style="position:relative;">
                        <label>密码</label>
                        <div class="xCombox" style="border: 1px solid #95b7ff;">
                            <label style="color:royalblue;margin:0px;">点击修改</label>
                            <div class="xPopWnd" style="left:-6px;width:200px;height:115px;padding:5px;display:none;">
                                <label style="margin-right:5px;">旧密码</label><input name="pwd" type="password" style="width:140px;height:20px;">
                                <label style="margin-right:5px;">新密码</label><input name="newpwd1" type="password" style="width:140px;height:20px;">
                                <label style="margin-right:5px;">新密码</label><input name="newpwd2" type="password" style="width:140px;height:20px;">
                                <div style="float:right"><button onclick="hidechgpwd(this)">确定</button> <button onclick="hidechgpwd(this)">取消</button></div>
                </div></div></div></div>`
            function f2f(user, field) {
                var name = field.name ? field.name : field;
                var val = user[name];

                var r = "";
                if (field.name == "sex")
                    r = RenderSelect(db_sex, val);
                else if (field.name == "job")
                    r = RenderSelect(GetsubJob(g_user.job, "array"), val);
                else if (field.name == "ethnic")
                    r = RenderSelect(g_ethnic, val);
                else
                    r = user[name];
                return r;
            }

            return xrfloatleft("height:240px;width:280px;margin-top:5px;", xrfloatleft("", xrimagelive2(user.face, "face", "imagelive", "height:78px;width:78px;"))
                + ui.format(user) + xrimagelive2(user.idimg, "idimg", "imagelive", "width:280px;height:160px;margin-top:5px")) + RenderForm4(g_user, fields, f2f);
        }

        function xrfloatleft(style,body) {
            return `<div style="float:left;display:block;{0}">{1}</div>`.format(style, body);
        }

        function save() {
            var formdata = new FormData(document.getElementById("main"));

            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/upload');
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    console.log('上传成功' + xhr.responseText);
                    //处理其他数据，这里根据需要进行调整
                }
            };
            xhr.setRequestHeader("Content-Type","multipart/form-data");
            xhr.send(formdata);
        }
        function skip() {
            return `<div style="float:left;display:block;{0}">{1}</div>`.format(style, body);
        }
        var g_chged = new Object();
        $("html").on("change", function () {
            var node = event.target;
            if (node.tagName == "INPUT")
                g_chged[$(node).attr("name")] = true;
        });
    </script>
</body>
</html>

<!--
input：普通录入
pwd：密码
image：图片
select：所在单位选择，职位选择，领域选择，籍贯（省地市）选择，
input
choice：性别选择，
date：日历，
image-->