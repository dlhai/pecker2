<!DOCTYPE html>
<html>
<head>
    <!--user2与user3的区别：将inplace编辑模式改成弹出6编辑窗口式-->
    <meta charset="utf-8">
    <title>啄木鸟风电维保系统</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="css/bootstrap.css"/>
    <script type="text/javascript" src="js/doTe.js"></script>
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.js"></script>
    <script src="laydate/laydate.js"></script>
    <script src="js/utils.js"></script>
    <link rel="stylesheet" href="css/cube.css" />
    <script src="js/Cube.js"></script>
    <script src="js/db.js"></script>
    <link rel="stylesheet" href="css/xpecker.css" />
    <script src="js/xpecker.js"></script>
    <script src="js/user.js"></script>

    <style>
        /*为了解决BootStrap中css和layDate的css样式冲突*/
        .laydate_box, .laydate_box * {box-sizing: content-box;}
        .laydate_box th {text-align: center;}
    </style>
</head>
<body>
    <div class="xFCscol" style="width:900px;margin:100px;">
        <header style="height:40px;">总步骤</header>
        <form id="certif_live" class="xRndAngle" style="margin:5px;padding:5px;"></form>
        <section class="xPanel2" style="display:inline-block;">
            <header>证件列表</header>
            <div id="certif_show" class="xScroll" style="padding: 5px;height:240px;flex-grow: 1;"></div>
        </section>
        <footer><div style="float:right"><button onclick="onnextstep()">下一步</button></div></footer>
    </div>

    <script type="text/javascript">
        Reqdata("/curuserinf", "", function (res) {
            g_user = res.data;
            Reqdata("/rd?ls=certif&user_id=" + g_user.id, "", function (ctf) {
                g_ctf = ctf;

                var xbtns = `<div style="display:inline-block;height:20px;">
                <input type="button" onclick="oncertifsave()" value="确定" />
                <input type="button" onclick="oncertifblank()" value="清除" /></div>`

                $("#certif_live").html(xrcertiflive(Create(g_ctf.fields), g_ctf.fields) + xbtns);
                $("#certif_show").html(xrcertifshow(ctf.data));
            });
        });

        function oncertifsave() {
            certifsave(function () {
                Reqdata("/rd?ls=certif&user_id=" + g_user.id, "", function (ctf) {
                    $("#certif_show").html(xrcertifshow(ctf.data));
                    $("#certif_live").html(xrcertiflive(Create(g_ctf.fields), g_ctf.fields));
                });
            });
        }

        function oncertifblank() {
            $("#certif_live").html(xrcertiflive(Create(g_ctf.fields), g_ctf.fields));
        }

        function onnextstep() {
            ReqdataP("/wt", `{"ls":"user","id":"{0}","val":{"status":"3"}}`.format(g_user.id));
            window.location.href = '/static/user_init3.html'
        }
    </script>
</body>
</html>
