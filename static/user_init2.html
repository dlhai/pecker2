<!DOCTYPE html>
<html>
<head>
    <!--user2与user3的区别：将inplace编辑模式改成弹出6编辑窗口式-->
    <meta charset="utf-8">
    <title>啄木鸟风电维保系统</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="css/bootstrap.css"/>
    <script type="text/javascript" src="js/doTe.js"></script>
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.js"></script>
    <script src="laydate/laydate.js"></script>
    <script src="js/utils.js"></script>
    <link rel="stylesheet" href="css/cube.css" />
    <script src="js/Cube.js"></script>
    <script src="js/db.js"></script>
    <link rel="stylesheet" href="css/xpecker.css" />
    <script src="js/xpecker.js"></script>

    <style>
        /*为了解决BootStrap中css和layDate的css样式冲突*/
        .laydate_box, .laydate_box * {box-sizing: content-box;}
        .laydate_box th {text-align: center;}
    </style>
</head>
<body>
    <div class="xFCscol" style="width:900px;margin:100px;">
        <header style="height:40px;">总步骤</header>
        <form id="certif" class="xRndAngle" style="margin:5px;padding:5px;">
            <div style="float:left;display:inline-block;">
                <label class="imagelive" style="width:126px;height:84px;" for="image">
                    <img style="width:100%;height:100%;" >
                    <input type="file" id="image" name="image" accept="image/*">
                </label>
            </div>
            <div class="x2Form" style="display:inline-block; width:620px;">
                <div><label>证件名称</label><input name="name" value=""></div>
                <div><label>颁发时间</label><input name="issuedate" value="" onclick="laydate()"></div>
                <div><label>颁发机构</label><input name="issue" style="width:495px;" value=""></div>
            </div>
            <div style="display:inline-block;height:20px;"><input type="button" onclick="newcertif(this)" value="确定" /> <button type="reset">清除</button></div>
        </form>
        <section class="xPanel2" style="display:inline-block;">
            <header>证件列表</header>
            <div id="main" class="xScroll" style="padding: 5px;height:240px;flex-grow: 1;"></div>
        </section>
        <footer><div style="float:right"><button onclick="nextstep()">下一步</button></div></footer>
    </div>

    <script id="tpl_certiflist" type="text/template">
        {% it.forEach((x,i)=>{ %}
        <div style="min-height: 85px;width: 100%; {% if (i%2==0) { %}background: #f5f5f5; {% } %}">
            <div class="xRndAngle" style="width: 126px; height: 84px; float: left; margin-right: 5px; ">
                <img style="width: 126px; height: 84px;" src="{%=x.image%}" />
            </div>
            <div class="x2Form">
                <div><label>证件名称</label><div>{%=x.name%}</div></div>
                <div><label>颁发时间</label><div>{%=x.issuedate%}</div></div>
                <div><label>颁发机构</label><div style="width:495px;">{%=x.issue%}</div></div>
            </div>
        </div>
        {% }); %}
    </script>


    <script type="text/javascript">
        Reqdata("/curuserinf", "", function (res) {
            g_user = res.data;
            Reqdata("/rd?ls=certif&user_id=" + g_user.id, "", function (ctf) {
                $("#main").html(dtpl2('tpl_certiflist')(ctf.data));
            });
        });
        function newcertif() {
            var formdata = new FormData(document.getElementById("certif"));
            if (formdata.get("name") == "") {
                alert("证件名称不能为空！");
                return;
            }
            if (formdata.get("issuedate") == "") {
                alert("颁发时间不能为空！");
                return;
            }
            if (formdata.get("issue") == "") {
                alert("颁发机构不能为空！");
                return;
            }

            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    Reqdata("/rd?ls=certif&user_id=" + g_user.id, "", function (ctf) {
                        $("#main").html(dtpl2('tpl_certiflist')(ctf.data));
                    });
                }
            };

            formdata.append("user_id", g_user.id);
            xhr.open('POST', '/cr?ls=certif', true);
            xhr.send(formdata);
        }
        function nextstep() {
            ReqdataP("/wt", `{"ls":"user","id":"{0}","val":{"status":"3"}}`.format(g_user.id));
        }
    </script>
</body>
</html>

<!--
input：普通录入
pwd：密码
image：图片
select：所在单位选择，职位选择，领域选择，籍贯（省地市）选择，
input
choice：性别选择，
date：日历，
image-->