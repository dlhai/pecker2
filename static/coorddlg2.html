<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>啄木鸟风电维保系统</title>
    <script src="js/jquery.js"></script>
    <link rel="stylesheet" href="css/bootstrap.css"/>
    <script src="js/bootstrap.js"></script>
    <script type="text/javascript" src="js/doTe.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/db.js"></script>
    <link rel="stylesheet" href="css/xpecker.css" />
    <link rel="stylesheet" href="css/Cube.css" />
    <script src="js/Cube.js"></script>
    <script src="js/xpecker.js"></script>

    <link rel="StyleSheet" href="css/coord_card.css" type="text/css" />
    <link rel="StyleSheet" href="css/coord_style.css" type="text/css" />


</head>
<body>
    <div style="margin:100px;">
        <div id="rolelist" class="xCombox xRndAngle" style="margin-top:5px; display:inline-block;"><span>调度人员</span><div class="xMenu">
            <div class="selected">调度人员</div><div>风场人员</div><div>设备人员</div><div>仓库人员</div><div>专家</div><div>维修人员</div>
        </div></div>
        <div id="userfilter" class="xCombox xRndAngle" style="margin-top:5px; display:inline-block;">
            <span>所有</span><div id="userfiltertree" class="xPopWnd" style="max-height:600px;overflow-y:auto;"></div>
        </div>
        <div id="filteruserlist" class="xScroll xRndAngle" style="margin-top:5px; width:500px;height:250px;padding:5px;">
            
        </div>
    </div>
    <style>
        .roleselect>div{margin: 5px;display:inline-block;}
        .roleselect {margin: 5px;display:inline-block;}
        .roleselect>.rolelist > div {background: #00ff00;margin:5px;padding:5px;}
        .live {background: #ffff00;}

        .SmallHead {
        }
        .SmallHead img {
            border-radius: 10px;
            width: 20px;
            height: 20px;
        }

        #filteruserlist >label> div {
            display: inline-block;
            margin: 5px;
            margin-right: 20px;
            font-weight:normal;
        }
        #userfilter>span > img {
            margin-right: 5px;
            width: 20px;
        }

    </style>
    <script type="text/javascript">

        //点在菜单项上
        $("html").on("click", function () {
            var node = $(event.target);
            if (node.parent().hasClass("xMenu")) { //点在菜单背景上
                var text = $(node).html();
                if (text == "调度人员") {
                    $("#userfilter span").html('所有　　');
                    $("#userfilter .xPopWnd").html('<div class="selected">所有　　</div>');
                    Reqdata("/rduser?job=" + GetsubJob(GetSub(db_job, "name", "调度超级帐号").id, "string"), "", function (res) {
                        $("#filteruserlist").html(res.data.map(x => crd_userwithface(x)));
                    });
                }
                else if (text == "风场人员") {
                    $("#userfilter span").html('　　　　　　');
                    $("#userfiltertree").html('');
                    g.userfiltertree = new x4Tree("#userfiltertree", "winderco", "", "winder", function(type, id, node) {
                        if (type == "winder") {
                            $("#userfilter>span").html(node.html());
                            $("#userfilter .xPopWnd").toggle();
                            Reqdata("/rduser?depart_id=" + id + "&depart_table=" + GetTbl("winder").id, "", function (res) {
                                $("#filteruserlist").html(res.data.map(x => crd_userwithface(x)));
                            });
                        }
                    });
                }
                else if ($(node).html() == "设备人员") {
                    $("#userfilter span").html('　　　　　　');
                    $("#userfiltertree").html('');
                    g.userfiltertree = new x4Tree("#userfiltertree", "devwh", "", "devwh", function (type, id, node){
                        if (type == "devwh") {
                            $("#userfilter>span").html(node.html());
                            $("#userfilter .xPopWnd").toggle();
                            Reqdata("/rduser?depart_id=" + id + "&depart_table=" + GetTbl("devwh").id, "", function (res) {
                                $("#filteruserlist").html(res.data.map(x => crd_userwithface(x)));
                            });
                        }
                    });
                }
                else if ($(node).html() == "仓库人员") {
                    $("#userfilter span").html('　　　　　　');
                    $("#userfiltertree").html('');
                    g.userfiltertree = new x4Tree("#userfiltertree", "matprov", "", "matwh", function (type, id, node) {
                        if (type == "matwh") {
                            $("#userfilter>span").html(node.html());
                            $("#userfilter .xPopWnd").toggle();
                            Reqdata("/rduser?depart_id=" + id + "&depart_table=" + GetTbl("matwh").id, "", function (res) {
                                $("#filteruserlist").html(res.data.map(x => crd_userwithface(x)));
                            });
                        }
                    });
                }
                else if ($(node).html() == "专家") {
                }
                else if ($(node).html() == "维修人员") {
                }
            }
        });

        function onTreeItemClick(type, id) {
            g_curwh = GetSub(g_devwhs.data, "id", id);
            $("#item_detail").html(RenderPane2(g_curwh, g_devwhs.fields));
            Reqdata("/rd?ls=dev&devwh_id=" + id, "", function (res) {
                g_devs = res;
                $("#subitem_list").html(RenderTable2(res, "", FieldToShow));
                TableBindClick3(res.type, function (devid) { g_curdev = GetSub(g_devs.data, "id", devid) });
            });
        }

        function crd_showuserselectdlg() {
            var dlg = new cbDlg("人员选择", "width:610px");
            //dlg.Add('<div>'+db_job.map(x=>'<div>'+(x.name.indexOf("超级帐号")==-1?x.name : "")+'</div>').join("")+'</div>')
            dlg.Add(crd_userselect())
            dlg.Show();
        }

        function crd_userselect() {
            var roles = ['调度人员', '风场人员', '设备人员', '仓库人员', '专家', '维修人员'];
            return '<div class="roleselect"><div class="rolelist">' + roles.map(x => '<div>' + x + '</div>').join("")
                + '</div><div id="userfilter"></div><div id="filteruserlist"></div></div>';
        }
        function crd_userwithface(user) {
            var tpl = `<label><input type="checkbox"><div class="SmallHead"><img src="{face}" />【{job}】{name}</div><label>`;
            return tpl.format(user);
        }




    </script>

    <script type="text/javascript">
        //var g_cursel = -1;
        //var g_user = parent.g_user, faultlist = [];
        //if (g_user == undefined)
        //    g_user = GetRoleUser("调度");


//        crd_showuserselectdlg();

    </script>

</body>
</html>

